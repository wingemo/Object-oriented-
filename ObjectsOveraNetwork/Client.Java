package com.wingemo;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.net.Socket;
import java.util.Properties;

/**
 * A Java lient that connects to a server and receives a Person object from the server.
 * The client then applies a tax rate to the person's income,
 * and prints a message to the console with the modified Person object.
 *
 * @Philip Wingemo
 */
public class Client implements Runnable {
  // The socket for connecting to the server
  private Socket socket;
  // The object input stream for reading the `Person` object from the server
  private ObjectInputStream ois;
  // The tax rate to use for calculating taxes.
  private double taxRate;

  private Properties config;

  /**
   * Creates a new Client instance.
   *
   * @param config a Properties object containing the host, port, and taxRate to use for the client
   */
  public Client(Properties config) throws IOException {
    this.config = config;
    this.socket = new Socket(config.getProperty("host"), Integer.parseInt(config.getProperty("port")));
    this.taxRate = Double.parseDouble(config.getProperty("taxRate"));
    this.ois = new ObjectInputStream(socket.getInputStream());
  }

  /**
   * Reads a {@link Person} object from an {@link ObjectInputStream} and applies a tax rate to the person's income.
   *
   * @return the modified {@link Person} object
   * @throws IOException if there is an error reading from the {@link ObjectInputStream}
   * @throws ClassNotFoundException if the {@link Person} class cannot be found
   */
  public Person receivePerson() throws IOException, ClassNotFoundException {
    Person person = (Person) ois.readObject();
    person.setNetIncome(taxRate * person.getIncome());
    return person;
  }

  /**
   * Closes the connection to the server.
   *
   * @throws IOException if an I/O error occurs
   */
  public void close() throws IOException {
    ois.close();
    socket.close();
  }

  public void run() {
    Person person = null;
    try {
      person = receivePerson();
      System.out.print(person);
    } catch (IOException e) {
      e.printStackTrace();
    } catch (ClassNotFoundException e) {
      e.printStackTrace();
    }
  }
}
